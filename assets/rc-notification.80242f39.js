import{f as w,g as K,h as S,i as R,e as _,d as D,c as U,j as E,a as N,b as j}from"./@babel.cf8b4fc6.js";import{r as d}from"./react.658dc38c.js";import{r as O,k as L}from"./rc-util.501ec4cf.js";import{c as T}from"./classnames.8d8ee7c7.js";import{a as W}from"./rc-motion.2bdb91e8.js";import{R as V}from"./react-dom.d5afb5cc.js";var P=function(k){w(m,k);var y=K(m);function m(){var e;S(this,m);for(var n=arguments.length,r=new Array(n),t=0;t<n;t++)r[t]=arguments[t];return e=y.call.apply(y,[this].concat(r)),e.closeTimer=null,e.close=function(i){i&&i.stopPropagation(),e.clearCloseTimer();var u=e.props,p=u.onClose,c=u.noticeKey;p&&p(c)},e.startCloseTimer=function(){e.props.duration&&(e.closeTimer=window.setTimeout(function(){e.close()},e.props.duration*1e3))},e.clearCloseTimer=function(){e.closeTimer&&(clearTimeout(e.closeTimer),e.closeTimer=null)},e}return R(m,[{key:"componentDidMount",value:function(){this.startCloseTimer()}},{key:"componentDidUpdate",value:function(n){(this.props.duration!==n.duration||this.props.updateMark!==n.updateMark||this.props.visible!==n.visible&&this.props.visible)&&this.restartCloseTimer()}},{key:"componentWillUnmount",value:function(){this.clearCloseTimer()}},{key:"restartCloseTimer",value:function(){this.clearCloseTimer(),this.startCloseTimer()}},{key:"render",value:function(){var n=this,r=this.props,t=r.prefixCls,i=r.className,u=r.closable,p=r.closeIcon,c=r.style,l=r.onClick,s=r.children,a=r.holder,o="".concat(t,"-notice"),v=Object.keys(this.props).reduce(function(C,f){return(f.substr(0,5)==="data-"||f.substr(0,5)==="aria-"||f==="role")&&(C[f]=n.props[f]),C},{}),h=d.exports.createElement("div",_({className:T(o,i,D({},"".concat(o,"-closable"),u)),style:c,onMouseEnter:this.clearCloseTimer,onMouseLeave:this.startCloseTimer,onClick:l},v),d.exports.createElement("div",{className:"".concat(o,"-content")},s),u?d.exports.createElement("a",{tabIndex:0,onClick:this.close,className:"".concat(o,"-close")},p||d.exports.createElement("span",{className:"".concat(o,"-close-x")})):null);return a?V.createPortal(h,a):h}}]),m}(d.exports.Component);P.defaultProps={onClose:function(){},duration:1.5};function F(k){var y=d.exports.useRef({}),m=d.exports.useState([]),e=U(m,2),n=e[0],r=e[1];function t(i){var u=!0;k.add(i,function(p,c){var l=c.key;if(p&&(!y.current[l]||u)){var s=d.exports.createElement(P,_({},c,{holder:p}));y.current[l]=s,r(function(a){var o=a.findIndex(function(h){return h.key===c.key});if(o===-1)return[].concat(E(a),[s]);var v=E(a);return v[o]=s,v})}u=!1})}return[t,d.exports.createElement(d.exports.Fragment,null,n)]}var q=["getContainer"],I=0,z=Date.now();function $(){var k=I;return I+=1,"rcNotification_".concat(z,"_").concat(k)}var M=function(k){w(m,k);var y=K(m);function m(){var e;S(this,m);for(var n=arguments.length,r=new Array(n),t=0;t<n;t++)r[t]=arguments[t];return e=y.call.apply(y,[this].concat(r)),e.state={notices:[]},e.hookRefs=new Map,e.add=function(i,u){var p,c=(p=i.key)!==null&&p!==void 0?p:$(),l=N(N({},i),{},{key:c}),s=e.props.maxCount;e.setState(function(a){var o=a.notices,v=o.map(function(C){return C.notice.key}).indexOf(c),h=o.concat();return v!==-1?h.splice(v,1,{notice:l,holderCallback:u}):(s&&o.length>=s&&(l.key=h[0].notice.key,l.updateMark=$(),l.userPassKey=c,h.shift()),h.push({notice:l,holderCallback:u})),{notices:h}})},e.remove=function(i){e.setState(function(u){var p=u.notices;return{notices:p.filter(function(c){var l=c.notice,s=l.key,a=l.userPassKey,o=a!=null?a:s;return o!==i})}})},e.noticePropsMap={},e}return R(m,[{key:"getTransitionName",value:function(){var n=this.props,r=n.prefixCls,t=n.animation,i=this.props.transitionName;return!i&&t&&(i="".concat(r,"-").concat(t)),i}},{key:"render",value:function(){var n=this,r=this.state.notices,t=this.props,i=t.prefixCls,u=t.className,p=t.closeIcon,c=t.style,l=[];return r.forEach(function(s,a){var o=s.notice,v=s.holderCallback,h=a===r.length-1?o.updateMark:void 0,C=o.key,f=o.userPassKey,b=N(N(N({prefixCls:i,closeIcon:p},o),o.props),{},{key:C,noticeKey:f||C,updateMark:h,onClose:function(x){var g;n.remove(x),(g=o.onClose)===null||g===void 0||g.call(o)},onClick:o.onClick,children:o.content});l.push(C),n.noticePropsMap[C]={props:b,holderCallback:v}}),d.exports.createElement("div",{className:T(i,u),style:c},d.exports.createElement(W,{keys:l,motionName:this.getTransitionName(),onVisibleChanged:function(a,o){var v=o.key;a||delete n.noticePropsMap[v]}},function(s){var a=s.key,o=s.className,v=s.style,h=s.visible,C=n.noticePropsMap[a],f=C.props,b=C.holderCallback;return b?d.exports.createElement("div",{key:a,className:T(o,"".concat(i,"-hook-holder")),style:N({},v),ref:function(x){typeof a!="undefined"&&(x?(n.hookRefs.set(a,x),b(x,f)):n.hookRefs.delete(a))}}):d.exports.createElement(P,_({},f,{className:T(o,f==null?void 0:f.className),style:N(N({},v),f==null?void 0:f.style),visible:h}))}))}}]),m}(d.exports.Component);M.newInstance=void 0;M.defaultProps={prefixCls:"rc-notification",animation:"fade",style:{top:65,left:"50%"}};M.newInstance=function(y,m){var e=y||{},n=e.getContainer,r=j(e,q),t=document.createElement("div");if(n){var i=n();i.appendChild(t)}else document.body.appendChild(t);var u=!1;function p(c){u||(u=!0,m({notice:function(s){c.add(s)},removeNotice:function(s){c.remove(s)},component:c,destroy:function(){L(t),t.parentNode&&t.parentNode.removeChild(t)},useNotification:function(){return F(c)}}))}O(d.exports.createElement(M,_({},r,{ref:p})),t)};export{M as N,F as u};
